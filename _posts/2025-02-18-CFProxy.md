---
layout: post
title: "Moving away from Cloudflare Protection"
categories: tech
tags: tech privacy freedom
summary: I've stopped using Cloudflare's Protection (Proxy Mode) for my websites, partly to avoid centralization of the internet, and partly because of their user-hostile behavior
---


## Disclaimer

I still use a lot of other cloudflare products, such as R2 for object storage and DNS for my domains. They have built a great suite of products and rival AWS & GCP in several offerings, often with better pricing. This little post is specifically about their "proxy" mode for DDoS (and other) protection though.

## What is CF's proxy mode?

When configure your DNS in cloudflare, there is a very tempting toggle, even on the free plan: "Proxy Mode". This is on by default when adding a new DNS record (well, if it's `A/AAAA/CNAME`). Cloudflare prominently lists the benfits of this, including:

* Protect your origin server from DDoS attacks
* Optimize, cache, and protect all requests to your application.
* Hiding the IP address of your actual server

To be clear, all of these are true. But are they necessary? At what cost?

## How it works

Cloudflare essentially does this by MiTMing the connection between a user and your webserver. This also includes inspecting all TLS traffic, which they say is used for determining malicious traffic.

Basically, in "Proxy Mode", the A record if your domain resolves to cloudflare's servers, which then complete the TLS handshake. They can do this since in proxy mode, you essentially allow them to issue TLS certs for your domain. Then, they forward the HTTP request (either over HTTP, or HTTPS) to your actual web server.

This seems pretty neat at first since your IP isn't exposed directly (unless via historical DNS data or numerous other misconfigurations), which gives the illusion that it is harder for attackers to target you (partially true).

## What's the downside?

Ok, so you've turned on Cloudflare in proxy mode, and feel all nice and protected. Well, now there's a 3rd party middleman between your users and your server, that can observe all the traffic, and even modify it!

They automatically inject some JS in your HTML pages, which you wouldn't realize just working on the source files. They also drop some cookies (reducing user privacy) and inject a bunch of HTTP headers.

// TBD: /cdn-cgi trace?

Also, proxying websites behind cloudflare contributes to the centralization of the internet; if CF has a bug in their proxying logic or similar, it will affect a good portion of the internet. It'll also likely be out of your control, unless you're able to update the DNS settings / proxying logic quickly enough.

## Phishing reports and the irony of DoS due to Cloudflare

If enough people report your website for phishing, then cloudflare might actually now prop up a big scary warning page before loading your website, again intercepting HTTP requests meant for your server and displaying something else to users. Unlike browser-bases warnings, which happen in the client's user-agent, this happens at the webserver level, since cloudflare can MiTM your traffic!

There's numerous complaints of users on their community forum being affected by this, and even contacting the abuse department seems to not have led to resolution.

## Captchas and User Hostility

We all probably remember ReCaptcha (well it still exists) and how we'd often have to manually click through at times when submitting a comment or logging in. In my view, it makes sense to some extent to gate such kinds of actions behind a captcha reduce the volume of abuse (spam, brute force attempts). However recently I've been seeing the cloudflare captcha turn up on > 50% of websites I visit, and even before anything is loaded! I need to wait for the captcha resources to load, and manually click through just for the privilege of viewing a website! In my opinion, this is absolutely absurd. The internet was meant to be open and facilitate information exchange, but now it seems like cloudflare is leading the charge to centralize and gatekeep it. I consider presenting captchas just for a user to view a homepage (aka a GET request) as malicious behavior. 

"But AI bots are stealing my content!"

Well, you can be damn sure that the multi-billion dollar companies that train such models can "bypass" these silly challenges (I use "bypass" in quotes, since technically they do probably solve them; they can afford the computing resources necessary for it).
